# This is a basic workflow to help you get started with Actions

name: Deploy Azure storage

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
    paths-ignore: ["*.ps1", ".github/workflows/*"]
 
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

env:
  RG_NAME: RG200
  RG_LOCATION: WestEurope

jobs:

  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: azure/login@v2
        name: sign into Azure
        with:
          client-id: ${{secrets.AZ_CLIENT_ID}}
          tenant-id: ${{secrets.AZ_TENANT_ID}}
          subscription-id: ${{secrets.AZ_SUB_ID}}

      - name: create RG
        uses: azure/cli@v2
        with:
          inlineScript: az group create --name ${{env.RG_NAME}} --location ${{env.RG_LOCATION}}

      - uses: azure/arm-deploy@v2
        name: deploy storage
        id: deploy-sa
        with:
          deploymentName: ${{github.run_number}}
          resourceGroupName: ${{env.RG_NAME}}
          template: ./storage.bicep

